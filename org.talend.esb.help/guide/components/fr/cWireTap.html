<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>cWireTap</title><meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"><link rel="home" href="index.html" title="Talend Open Studio"><link rel="up" href="ch06.html" title="Chapitre&nbsp;6.&nbsp;Composants Routing"><link rel="prev" href="cRoutingSlip.html" title="cRoutingSlip"><link rel="next" href="ch07.html" title="Chapitre&nbsp;7.&nbsp;Composants Transformation"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div lang="fr" class="section" title="cWireTap"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cWireTap"></a>cWireTap</h2></div></div></div><div class="mediaobject"><img src="../images/cwiretap_icon32.png"></div><div class="section" title="Propri&eacute;t&eacute;s du cWireTap"><div class="titlepage"><div><div><h3 class="title"><a name="d0e15505"></a>Propri&eacute;t&eacute;s du cWireTap</h3></div></div></div><div class="informaltable"><table border="1"><colgroup><col class="c1"><col class="c2"><col class="c3"></colgroup><tbody><tr><td valign="top">
							<p>
								<span class="bold"><strong>Famille de composant</strong></span>
							</p>
						</td><td colspan="2" valign="top">
							<p>Routing</p>
						</td></tr><tr><td valign="top">
							<p>
								<span class="bold"><strong>Fonction</strong></span>
							</p>
						</td><td colspan="2" valign="top">
							<p>Le composant <span class="bold"><strong>cWireTap</strong></span> vous permet de router des
								messages vers un endpoint d'&eacute;coute s&eacute;par&eacute; pendant qu'il est pass&eacute; &agrave;
								sa destination finale.</p>
						</td></tr><tr><td valign="top">
							<p>
								<span class="bold"><strong>Objectif</strong></span>
							</p>
						</td><td colspan="2" valign="top">
							<p>Le <span class="bold"><strong>cWireTap</strong></span> est utilis&eacute; pour router des messages vers
								un endpoint s&eacute;par&eacute; en m&ecirc;me temps qu'il est pass&eacute; &agrave; sa derni&egrave;re
								destination.</p>
						</td></tr><tr><td valign="top">
							<p>
								<span class="bold"><strong>Basic settings</strong></span>
							</p>
						</td><td valign="top">
							<p>
								<span class="emphasis"><em>URI</em></span>
							</p>
						</td><td valign="top">
							<p>L'URI de l'endpoint o&ugrave; envoyer le message &eacute;cout&eacute;.</p>
						</td></tr><tr><td>
							<p>&nbsp;</p>
						</td><td valign="top">
							<p>
								<span class="emphasis"><em>Populate new exchange</em></span>
							</p>
						</td><td valign="top">
							<p>Cochez cette case pour alimenter un nouvel &eacute;change du message.</p>
						</td></tr><tr><td>
							<p>&nbsp;</p>
						</td><td valign="top">
							<p>
								<span class="emphasis"><em>Populate Type</em></span>
							</p>
						</td><td valign="top">
							<p>Cette option appara&icirc;t lorsque la case <span class="bold"><strong>Populate new
									exchange</strong></span> est coch&eacute;e. Le type <span class="bold"><strong>Populate Type</strong></span> peut &ecirc;tre <span class="bold"><strong>Expression</strong></span> ou <span class="bold"><strong>Processor</strong></span>. </p>
						</td></tr><tr><td>
							<p>&nbsp;</p>
						</td><td valign="top">
							<p> </p>
						</td><td valign="top">
							<p><span class="bold"><strong>Expression</strong></span> : Utiliser une expression vous permet de
								d&eacute;finir le corps du message du nouvel &eacute;change.</p>
							<p><span class="bold"><strong>Language</strong></span> : S&eacute;lectionnez le langage de l'expression que
								vous souhaitez utiliser pour d&eacute;finir le corps du message, parmi
									<span class="bold"><strong>Constant</strong></span>, <span class="bold"><strong>Header</strong></span>, <span class="bold"><strong>None</strong></span>,
									<span class="bold"><strong>Property</strong></span>, <span class="bold"><strong>Simple</strong></span> et <span class="bold"><strong>XPath</strong></span>.</p>
							<p><span class="bold"><strong>Expression</strong></span> : Saisissez l'expression pour d&eacute;finir le
								corps du message.</p>
						</td></tr><tr><td>&nbsp;</td><td valign="top">&nbsp;</td><td valign="top"><span class="bold"><strong>Processor</strong></span> : Utiliser le <span class="bold"><strong>cProcessor</strong></span> vous permet de sp&eacute;cifier comment
							l'&eacute;change est aliment&eacute; lors de la configuration des propri&eacute;t&eacute;s, des
							en-t&ecirc;tes, etc. du message avec un morceau de code Java dans le champ
								<span class="bold"><strong>Code</strong></span>. </td></tr><tr><td>&nbsp;</td><td valign="top"><span class="emphasis"><em>Copy the original message</em></span></td><td valign="top">Cochez cette case pour utiliser une copie de l'&eacute;change lors de l'&eacute;coute du
							message. Cette option appara&icirc;t lorsque la case <span class="bold"><strong>Populate new exchange</strong></span> est coch&eacute;e. </td></tr><tr><td valign="top">
							<p>
								<span class="bold"><strong>Utilisation</strong></span>
							</p>
						</td><td colspan="2" valign="top">
							<p>Le <span class="bold"><strong>cWireTap</strong></span> est g&eacute;n&eacute;ralement utilis&eacute; en tant que
								composant interm&eacute;diaire dans une Route.</p>
						</td></tr><tr><td valign="top">
							<p>
								<span class="bold"><strong>Limitation</strong></span>
							</p>
						</td><td colspan="2">
							<p>&nbsp;n/a</p>
						</td></tr></tbody></table></div></div><div class="section" title="Sc&eacute;nario : Ecouter un message dans une Route"><div class="titlepage"><div><div><h3 class="title"><a name="nwang-20111213-camel_components-cwiretap"></a>Sc&eacute;nario : Ecouter un message dans une Route</h3></div></div></div><p>Dans ce sc&eacute;nario, un composant <span class="bold"><strong>cWireTap</strong></span> est utilis&eacute; pour
			router un message vers un endpoint s&eacute;par&eacute;  pendant qu'il est rout&eacute; vers son ultime
			destination.</p><div class="mediaobject" align="center"><img src="../images/use_case-cwiretap1.png" align="middle"></div><div class="section" title="D&eacute;poser et relier les composants"><div class="titlepage"><div><div><h4 class="title"><a name="d0e15745"></a>D&eacute;poser et relier les composants</h4></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="&Eacute;tape 1"><p>Dans la <span class="bold"><strong>Palette</strong></span>, d&eacute;veloppez le dossier <span class="bold"><strong>Messaging</strong></span> et d&eacute;posez un composant <span class="bold"><strong>cFile</strong></span> ainsi que deux <span class="bold"><strong>cMessagingEndpoint</strong></span> dans l'espace de mod&eacute;lisation
							graphique.</p></li><li class="step" title="&Eacute;tape 2"><p>D&eacute;veloppez le dossier <span class="bold"><strong>Routing</strong></span> et d&eacute;posez un <span class="bold"><strong>cWireTap</strong></span> dans l'espace de mod&eacute;lisation
							graphique.</p></li><li class="step" title="&Eacute;tape 3"><p>D&eacute;veloppez le dossier <span class="bold"><strong>Processor</strong></span> et d&eacute;posez un composant
							<span class="bold"><strong>cJavaDSLProcessor</strong></span> ainsi que deux
							<span class="bold"><strong>cProcessor</strong></span> dans l'espace de
							mod&eacute;lisation graphique.</p></li><li class="step" title="&Eacute;tape 4"><p>Cliquez-droit sur le composant <span class="bold"><strong>cFile</strong></span>, s&eacute;lectionnez
							<span class="bold"><strong>Row</strong></span> &gt; <span class="bold"><strong>Route</strong></span> dans le menu contextuel et cliquez sur le <span class="bold"><strong>cWireTap</strong></span>.</p></li><li class="step" title="&Eacute;tape 5"><p>R&eacute;p&eacute;tez cette op&eacute;ration pour relier les composants dans la capture d'&eacute;cran.</p></li><li class="step" title="&Eacute;tape 6"><p>Renommez les composants afin de mieux identifier leur fonctionnalit&eacute;.</p></li></ol></div></div><div class="section" title="Configurer les composants"><div class="titlepage"><div><div><h4 class="title"><a name="d0e15806"></a>Configurer les composants</h4></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="&Eacute;tape 1"><p>Double-cliquez sur le composant <span class="bold"><strong>cFile</strong></span> nomm&eacute;
							<span class="emphasis"><em>Source</em></span> pour afficher sa vue <span class="bold"><strong>Basic settings</strong></span>.</p><div class="mediaobject" align="center"><img src="../images/use_case-cwiretap2.png" align="middle"></div></li><li class="step" title="&Eacute;tape 2"><p>Dans le champ <span class="bold"><strong>Path</strong></span>, saisissez le chemin d'acc&egrave;s au
						fichier d'entr&eacute;e ou parcourez votre syst&egrave;me jusqu'&agrave; celui-ci. Dans ce
						sc&eacute;nario, le fichier sp&eacute;cifi&eacute; dans le chemin d'acc&egrave;s est
							<span class="emphasis"><em>Hello.txt</em></span> et contient la phrase <span class="emphasis"><em>Hello
							World!</em></span>. Laissez les autres param&egrave;tres tels qu'ils
						sont.</p></li><li class="step" title="&Eacute;tape 3"><p>Double-cliquez sur le composant <span class="bold"><strong>cWireTap</strong></span> pour afficher
						sa vue <span class="bold"><strong>Basic settings</strong></span>.</p><div class="mediaobject" align="center"><img src="../images/use_case-cwiretap3.png" align="middle"></div></li><li class="step" title="&Eacute;tape 4"><p>Saisissez <code class="code">"direct:a"</code> dans le champ <span class="bold"><strong>URI</strong></span> pour
						router le message &eacute;cout&eacute; vers cet endpoint. </p><p>Cochez la case <span class="bold"><strong>Populate new exchange</strong></span>,
						s&eacute;lectionnez <span class="bold"><strong>Processor</strong></span> dans la zone
							<span class="bold"><strong>Populate Type</strong></span> puis saisissez le code
						suivant dans le champ <span class="bold"><strong>Code</strong></span> pour afficher le
						nom de fichier du message &eacute;cout&eacute; ainsi que son contenu dans la console
						:</p><p>
						</p><pre class="programlisting">System.out.println("\nMessage wiretapped: "+
exchange.getIn().getHeader("CamelFileName"));
System.out.println("Message content: "+
exchange.getIn().getBody(String.class)+"\n");</pre><p>
					</p></li><li class="step" title="&Eacute;tape 5"><p> Double-cliquez sur le composant <span class="bold"><strong>cJavaDSLProcessor</strong></span> pour
						afficher sa vue <span class="bold"><strong>Basic settings</strong></span> dans la vue
							<span class="bold"><strong>Component</strong></span></p><div class="mediaobject" align="center"><img src="../images/use_case-cwiretap4.png" align="middle"></div></li><li class="step" title="&Eacute;tape 6"><p>Dans le champ <span class="bold"><strong>Code</strong></span>, saisissez le code Java
							<code class="code">.to("direct:b")</code> pour d&eacute;finir l'URI de l'endpoint vers
						lequel router le message original.</p></li><li class="step" title="&Eacute;tape 7"><p>Double-cliquez sur le composant <span class="bold"><strong>cMessagingEndpoint</strong></span> nomm&eacute;
							<span class="emphasis"><em>Endpoint_a</em></span> pour afficher sa vue <span class="bold"><strong>Basic settings</strong></span>. Saisissez <code class="code">"direct:a"</code>
						dans le champ <span class="bold"><strong>URI</strong></span> afin de r&eacute;cup&eacute;rer le
						message rout&eacute; vers cet endpoint. </p><div class="mediaobject" align="center"><img src="../images/use_case-cwiretap5.png" align="middle"></div><p>R&eacute;p&eacute;tez cette op&eacute;ration pour configurer l'URI de l'endpoint pour
							<span class="emphasis"><em>Endpoint_b</em></span>.</p></li><li class="step" title="&Eacute;tape 8"><p>Double-cliquez sur le composant <span class="bold"><strong>cProcessor</strong></span> nomm&eacute;
							<span class="italic">Monitor_a</span> pour afficher sa vue
							<span class="bold"><strong>Basic settings</strong></span>. Saisissez le code
						suivant dans le champ <span class="bold"><strong>Code</strong></span> pour afficher le
						nom de fichier du message rout&eacute; vers l'<span class="italic">Endpoint_a</span>. </p><p>
						</p><pre class="programlisting">System.out.println("Message on endpoint a: "+
exchange.getIn().getHeader("CamelFileName"));</pre><p>
					</p><p>
						</p><div class="mediaobject" align="center"><img src="../images/use_case-cwiretap6.png" align="middle"></div><p>
					</p><p>Configurez l'autre composant <span class="bold"><strong>cProcessor</strong></span> de
						la m&ecirc;me mani&egrave;re afin d'afficher le nom de fichier du message rout&eacute; vers
							l'<span class="italic">Endpoint_b</span>.</p></li><li class="step" title="&Eacute;tape 9"><p>Appuyez sur <span class="bold"><strong>Ctrl+S</strong></span> pour sauvegarder votre Route.</p></li></ol></div></div><div class="section" title="Visualiser du code et ex&eacute;cuter la Route"><div class="titlepage"><div><div><h4 class="title"><a name="d0e15969"></a>Visualiser du code et ex&eacute;cuter la Route</h4></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="&Eacute;tape 1"><p>Cliquez sur l'onglet <span class="bold"><strong>Code</strong></span> au bas de l'espace de
						mod&eacute;lisation graphique afin de visualiser le code g&eacute;n&eacute;r&eacute;.</p><div class="mediaobject" align="center"><img src="../images/use_case-cwiretap8.png" align="middle"></div><p>Dans le code partiellement affich&eacute;, tout message provenant (<code class="code">from</code>) de
						l'endpoint <code class="code">Source</code> sera &eacute;cout&eacute; par <code class="code">.wireTap</code> et
						rout&eacute; vers <code class="code">"direct:a"</code>. Le nom du fichier et le contenu de
						chaque message &eacute;cout&eacute; est affich&eacute; dans la console. Le message original est
						rout&eacute; vers (<code class="code">.to</code>) un endpoint identifi&eacute; par l'URI
							<code class="code">"direct:b"</code>, d&eacute;fini dans le
						<code class="code">cJavaDSLProcessor_1</code>.</p></li><li class="step" title="&Eacute;tape 2"><p>Cliquez sur la vue <span class="bold"><strong>Run</strong></span> pour l'afficher et cliquez sur le
						bouton <span class="bold"><strong>Run</strong></span> pour lancer l'ex&eacute;cution de la
						Route. Vous pouvez &eacute;galement appuyez sur <span class="bold"><strong>F6</strong></span>
						pour l'ex&eacute;cuter. </p><p>R&eacute;sultat : Le message source est &eacute;cout&eacute; et rout&eacute; vers l'endpoint <span class="italic">a</span> et vers l'endpoint <span class="emphasis"><em>b</em></span>.</p><div class="mediaobject" align="center"><img src="../images/use_case-cwiretap9.png" align="middle"></div></li></ol></div></div></div></div></body></html>