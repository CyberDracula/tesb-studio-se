<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>cJMS</title><meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"><link rel="home" href="index.html" title="Talend Open Studio"><link rel="up" href="ch03.html" title="Chapitre&nbsp;3.&nbsp;Composants Messaging"><link rel="prev" href="cHttp.html" title="cHttp"><link rel="next" href="cMail.html" title="cMail"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div lang="fr" class="section" title="cJMS"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cJMS"></a>cJMS</h2></div></div></div><div class="mediaobject"><img src="../images/cjms_icon32_white.png"></div><div class="section" title="Propri&eacute;t&eacute;s du cJMS"><div class="titlepage"><div><div><h3 class="title"><a name="d0e4915"></a>Propri&eacute;t&eacute;s du cJMS</h3></div></div></div><div class="informaltable"><table border="1"><colgroup><col class="c1"><col class="c2"><col class="c3"></colgroup><tbody><tr><td valign="top">
							<p>
								<span class="bold"><strong>Famille de composant</strong></span>
							</p>
						</td><td colspan="2" valign="top">
							<p>Messaging</p>
						</td></tr><tr><td valign="top">
							<p>
								<span class="bold"><strong>Fonction</strong></span>
							</p>
						</td><td colspan="2" valign="top">
							<p>Le composant <span class="bold"><strong>cJMS</strong></span> permet d'envoyer des messages vers
								(ou de consommer des messages d') une file ou un sujet JMS.</p>
						</td></tr><tr><td valign="top">
							<p>
								<span class="bold"><strong>Objectif</strong></span>
							</p>
						</td><td colspan="2" valign="top">
							<p>Le <span class="bold"><strong>cJMS</strong></span> est utilis&eacute; pour envoyer des messages vers ou
								pour consommer des messages depuis une file ou un sujet JMS.</p>
						</td></tr><tr><td>
							<p>&nbsp;</p>
						</td><td valign="top">
							<p>
								<span class="emphasis"><em>URI/Type</em></span>
							</p>
						</td><td valign="top">
							<p>S&eacute;lectionnez le type de message, <span class="bold"><strong>queue</strong></span> (file) ou
									<span class="bold"><strong>topic</strong></span> (sujet).</p>
						</td></tr><tr><td>
							<p>&nbsp;</p>
						</td><td valign="top">
							<p>
								<span class="emphasis"><em>URI/Destination</em></span>
							</p>
						</td><td valign="top">
							<p>Saisissez un nom pour la file ou le sujet JMS. </p>
						</td></tr><tr><td>&nbsp;</td><td valign="top">
							<p><span class="italic">ConnectionFactory</span>
							</p>
						</td><td valign="top">
							<p>Cliquez sur le bouton <span class="bold"><strong>[...]</strong></span> et s&eacute;lectionnez une
								ConnectionFactory JMS &agrave; utiliser pour la gestion des messages ou
								saisissez le nom du composant <span class="bold"><strong>cJMSConnectionFactory</strong></span> directement dans le
								champ.</p>
						</td></tr><tr><td>
							<span class="bold"><strong>Advanced settings</strong></span>
						</td><td valign="top">
							<span class="emphasis"><em>URI Options</em></span>
						</td><td valign="top">Configurez les arguments facultatifs dans la table correspondante. Cliquez
							sur le bouton <span class="bold"><strong>[+]</strong></span> autant de fois que
							n&eacute;cessaire pour ajouter des arguments &agrave; la table. Cliquez ensuite sur le
							champ <span class="bold"><strong>Value</strong></span> correspondant pour saisir
							une valeur. Consultez le site <a class="link" href="http://camel.apache.org/jms.html" target="_top">http://camel.apache.org/jms.html</a> (en anglais) pour voir les
							options d'URI disponibles.</td></tr><tr><td valign="top">
							<p>
								<span class="bold"><strong>Utilisation</strong></span>
							</p>
						</td><td colspan="2" valign="top">
							<p>Le <span class="bold"><strong>cJMS</strong></span> peut &ecirc;tre utilis&eacute; en tant que composant de
								d&eacute;but, composant interm&eacute;diaire ou composant de fin dans une
								Route.</p>
						</td></tr><tr><td valign="top">
							<p>
								<span class="bold"><strong>Limitation</strong></span>
							</p>
						</td><td colspan="2">
							<p>&nbsp;n/a</p>
						</td></tr></tbody></table></div></div><div class="section" title="Sc&eacute;nario : Envoyer et recevoir un message d'une file JMS"><div class="titlepage"><div><div><h3 class="title"><a name="nwang-20111014-camel_components-cjms_s1"></a>Sc&eacute;nario : Envoyer et recevoir un message d'une file JMS</h3></div></div></div><p>Dans ce sc&eacute;nario, un composant <span class="bold"><strong>cJMS</strong></span> envoie des messages
			depuis un syst&egrave;me de fichiers local vers une file de messages dans une Route. Les
			messages sont consomm&eacute; par un autre composant <span class="bold"><strong>cJMS</strong></span> dans
			une autre Route.</p><div class="mediaobject"><img src="../images/use_case_cjms1.png"></div><div class="section" title="D&eacute;poser et relier les composants"><div class="titlepage"><div><div><h4 class="title"><a name="d0e5103"></a>D&eacute;poser et relier les composants</h4></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="&Eacute;tape 1"><p>Dans la <span class="bold"><strong>Palette</strong></span>, d&eacute;veloppez le dossier
							<span class="bold"><strong>Contexts</strong></span> et d&eacute;posez un composant
							<span class="bold"><strong>cJMSConnectionFactory</strong></span> dans l'espace de
						mod&eacute;lisation graphique afin de sp&eacute;cifier la ConnectionFactory JMS pour g&eacute;rer
						les messages.</p></li><li class="step" title="&Eacute;tape 2"><p>Du dossier <span class="bold"><strong>Messaging</strong></span> de la <span class="bold"><strong>Palette</strong></span>, d&eacute;posez un composant <span class="bold"><strong>cFile</strong></span> et deux <span class="bold"><strong>cJMS</strong></span> dans
						l'espace de mod&eacute;lisation graphique. </p></li><li class="step" title="&Eacute;tape 3"><p>Du dossier <span class="bold"><strong>Processor</strong></span> de la <span class="bold"><strong>Palette</strong></span>, d&eacute;posez un <span class="bold"><strong>cProcessor</strong></span> dans l'espace de mod&eacute;lisation graphique.</p></li><li class="step" title="&Eacute;tape 4"><p>Reliez le composant <span class="bold"><strong>cFile</strong></span> au premier <span class="bold"><strong>cJMS</strong></span> &agrave; l'aide d'un lien <span class="bold"><strong>Row</strong></span> &gt; <span class="bold"><strong>Route</strong></span> afin de cr&eacute;er
						une Route productrice de messages.</p></li><li class="step" title="&Eacute;tape 5"><p>Reliez le second composant <span class="bold"><strong>cJMS</strong></span> au <span class="bold"><strong>cProcessor</strong></span> &agrave; l'aide d'un lien <span class="bold"><strong>Row</strong></span> &gt; <span class="bold"><strong>Route</strong></span> afin de cr&eacute;er
						une Route consommatrice de messages.</p></li><li class="step" title="&Eacute;tape 6"><p>Renommez les composants dans les deux Routes afin de mieux identifier leur
						fonctionnalit&eacute;.</p></li></ol></div></div><div class="section" title="Configurer les composants"><div class="titlepage"><div><div><h4 class="title"><a name="d0e5179"></a>Configurer les composants</h4></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="&Eacute;tape 1"><p>Double-cliquez sur le composant <span class="bold"><strong>cJMSConnectionFactory</strong></span>
						pour afficher sa vue <span class="bold"><strong>Basic settings</strong></span>.</p><div class="mediaobject"><img src="../images/use_case_cjms1bis.png"></div></li><li class="step" title="&Eacute;tape 2"><p>Dans la liste <span class="bold"><strong>MQ Server</strong></span>, s&eacute;lectionnez un serveur MQ.
						Dans ce sc&eacute;nario, s&eacute;lectionnez le serveur par d&eacute;faut, ActiveMQ afin de g&eacute;rer
						les messages. </p><p>Dans le champ <span class="bold"><strong>Broker URI</strong></span>, saisissez l'URI du broker de
						messages. Utilisez l'URI par d&eacute;faut :
							<code class="code">"vm://localhost?broker.persistent=false"</code>.</p></li><li class="step" title="&Eacute;tape 3"><p>Dans la Route productrice de messages, double-cliquez sur le composant <span class="bold"><strong>cFile</strong></span> afin d'afficher sa vue <span class="bold"><strong>Basic settings</strong></span>.</p><div class="mediaobject"><img src="../images/use_case_cjms2.png"></div></li><li class="step" title="&Eacute;tape 4"><p>D&eacute;finissez les propri&eacute;t&eacute;s du <span class="bold"><strong>cFile</strong></span>.</p><p>Dans ce sc&eacute;nario, sp&eacute;cifiez simplement le chemin d'acc&egrave;s au dossier
						contenant le fichier source &agrave; envoyer comme message &eacute;lectronique et laissez
						les autres param&egrave;tres tels qu'ils sont.</p></li><li class="step" title="&Eacute;tape 5"><p>Double-cliquez sur le <span class="bold"><strong>cJMS</strong></span> nomm&eacute;
							<span class="italic">Message_producer</span> pour afficher sa vue
							<span class="bold"><strong>Basic settings</strong></span>.</p><div class="mediaobject"><img src="../images/use_case_cjms3.png"></div></li><li class="step" title="&Eacute;tape 6"><p>Dans la liste <span class="bold"><strong>Type</strong></span>, s&eacute;lectionnez <span class="bold"><strong>queue</strong></span> pour envoyer les messages dans une file JMS.</p><p>Dans le champ <span class="bold"><strong>Destination</strong></span>, saisissez le nom de la file
						JMS, <code class="code">"queue.hello"</code> dans cet exemple.</p><p>Double-cliquez sur le bouton <span class="bold"><strong>[...]</strong></span> &agrave; c&ocirc;t&eacute; de <span class="bold"><strong>ConnectionFactory</strong></span>. S&eacute;lectionnez la
						ConnectionFactory JMS que vous venez de configurer puis cliquez sur
							<span class="bold"><strong>OK</strong></span>. Vous pouvez &eacute;galement saisir le nom
						du composant <span class="bold"><strong>cJMSConnectionFactory</strong></span>
						directement dans le champ.</p><div class="mediaobject"><img src="../images/use_case_cjms8.png"></div></li><li class="step" title="&Eacute;tape 7"><p>Passez &agrave; la Route consommatrice de messages et double-cliquez sur le composant <span class="bold"><strong>cJMS</strong></span> nomm&eacute; <span class="italic">Message_consumer</span> pour afficher sa vue <span class="bold"><strong>Basic settings</strong></span>.</p><div class="mediaobject"><img src="../images/use_case_cjms4.png"></div></li><li class="step" title="&Eacute;tape 8"><p>Configurez le consommateur de messages en utilisant exactement les m&ecirc;mes param&egrave;tres que
						dans le producteur de messages. </p></li><li class="step" title="&Eacute;tape 9"><p>Double-cliquez sur le composant <span class="bold"><strong>cProcessor</strong></span> pour afficher
						sa vue <span class="bold"><strong>Basic settings</strong></span>.</p><div class="mediaobject"><img src="../images/use_case_cjms5.png"></div></li><li class="step" title="&Eacute;tape 10"><p>Dans la zone <span class="bold"><strong>Code</strong></span>, personnalisez le code pour afficher
						le nom des fichiers des messages consomm&eacute;s dans la console de la vue
							<span class="bold"><strong>Run</strong></span>.</p><pre class="programlisting">System.out.println("Message consumed: "+
exchange.getIn().getHeader("CamelFileName"));</pre></li><li class="step" title="&Eacute;tape 11"><p>Appuyez sur <span class="bold"><strong>Ctrl+S</strong></span> pour sauvegarder vos Routes.</p></li></ol></div></div><div class="section" title="Visualiser du code et ex&eacute;cuter la Route"><div class="titlepage"><div><div><h4 class="title"><a name="d0e5325"></a>Visualiser du code et ex&eacute;cuter la Route</h4></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="&Eacute;tape 1"><p>Cliquez sur l'onglet <span class="bold"><strong>Code</strong></span> au bas des l'espace de
						mod&eacute;lisation graphique pour visualiser le code g&eacute;n&eacute;r&eacute;. </p><div class="mediaobject"><img src="../images/use_case_cjms6_1.png"></div><div class="mediaobject"><img src="../images/use_case_cjms6_2.png"></div><p>Comme affich&eacute; dans le code ci-dessus, une Route de messages est construite &agrave; partir d'un
							(<code class="code">from</code>) fichier source (<code class="code">File_source</code>) vers
							(<code class="code">.to</code>) le producteur de messages
							(<code class="code">Message_producer</code>), qui envoie le message dans une file de
						messages via un broker identifi&eacute; par
							<code class="code">vm://localhost?broker.persistent=false</code>. Le message
						provenant (<code class="code">from</code>) du <code class="code">Message_consumer</code> est trait&eacute;
						par le <code class="code">cProcessor_1</code>.</p></li><li class="step" title="&Eacute;tape 2"><p>Cliquez sur le bouton <span class="bold"><strong>Run</strong></span> de la vue <span class="bold"><strong>Run</strong></span> pour ex&eacute;cuter chacune de vos Routes. Vous
						pouvez &eacute;galement appuyer sur <span class="bold"><strong>F6</strong></span> pour les
						ex&eacute;cuter. </p><p>R&eacute;sultat : Les messages sont re&ccedil;us par le consommateur, comme affich&eacute; dans la console de
						la vue <span class="bold"><strong>Run</strong></span>.</p><div class="mediaobject"><img src="../images/use_case_cjms7.png"></div></li></ol></div></div></div><div class="section" title="Scenario: Mettre en place une transaction JMS locale"><div class="titlepage"><div><div><h3 class="title"><a name="lgaudens-20120419-camel_components-cjms_s2"></a>Scenario: Mettre en place une transaction JMS locale</h3></div></div></div><p>Dans ce sc&eacute;nario, une transaction locale compos&eacute;e de trois &eacute;tapes est effectu&eacute;e pour
			envoyer, tester et consommer un message JMS&nbsp;:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>La premi&egrave;re Route est utilis&eacute;e pour envoyer un message <span class="italic">"hello
						world!"</span> qui alimente la file JMS <span class="italic">queue.hello</span>.</p></li><li class="listitem"><p>La deuxi&egrave;me Route est utilis&eacute;e pour tester le message JMS re&ccedil;u. Six tentatives
					d'envoi dans la file <span class="italic">queue.hello</span> sont
					effectu&eacute;es avant que le message ne soit d&eacute;plac&eacute; dans la file JMS <span class="italic">Dead Letter</span>. Cette Route est programm&eacute;e pour
					g&eacute;n&eacute;rer une exception &agrave; chaque fois qu'un &eacute;change est trait&eacute; par la
					Route.</p></li><li class="listitem"><p>La derni&egrave;re Route est utilis&eacute;e pour consommer le message <span class="italic">"hello world!"</span> situ&eacute; dans la file JMS <span class="italic">Dead Letter</span>.</p></li></ol></div><div class="section" title="Envoyer un message dans la file JMS queue.hello"><div class="titlepage"><div><div><h4 class="title"><a name="d0e5420"></a>Envoyer un message dans la file JMS <span class="italic">queue.hello</span></h4></div></div></div><div class="mediaobject"><img src="../images/use_case-cjms9.png"></div><div class="procedure" title="Proc&eacute;dure&nbsp;3.1.&nbsp;D&eacute;poser et relier les composants"><a name="d0e5428"></a><p class="title"><b>Proc&eacute;dure&nbsp;3.1.&nbsp;D&eacute;poser et relier les composants</b></p><ol class="procedure" type="1"><li class="step" title="&Eacute;tape 1"><p>Depuis la <span class="bold"><strong>Palette</strong></span>, d&eacute;posez les cinq
						composants suivants dans l'espace de mod&eacute;lisation graphique&nbsp;: un <span class="bold"><strong>cJMSConnectionFactory</strong></span>, un <span class="bold"><strong>cConfig</strong></span>, un <span class="bold"><strong>cMessagingEndpoint</strong></span>, un <span class="bold"><strong>cJMS</strong></span>
						et un composant <span class="bold"><strong>cProcessor</strong></span>.</p></li><li class="step" title="&Eacute;tape 2"><p>Reliez le composant <span class="bold"><strong>cMessagingEndpoint</strong></span> au
							<span class="bold"><strong>cJMS</strong></span> &agrave; l'aide d'un lien <span class="bold"><strong>Row</strong></span> &gt; <span class="bold"><strong>Route</strong></span>.</p></li><li class="step" title="&Eacute;tape 3"><p>Reliez le composant <span class="bold"><strong>cJMS</strong></span> au <span class="bold"><strong>cProcessor</strong></span> &agrave; l'aide d'un lien <span class="bold"><strong>Row</strong></span> &gt; <span class="bold"><strong>Route</strong></span>.</p></li></ol></div><div class="procedure" title="Proc&eacute;dure&nbsp;3.2.&nbsp;Configurer les composants"><a name="d0e5482"></a><p class="title"><b>Proc&eacute;dure&nbsp;3.2.&nbsp;Configurer les composants</b></p><ol class="procedure" type="1"><li class="step" title="&Eacute;tape 1"><p>Double-cliquez sur le composant <span class="bold"><strong>cJMSConnectionFactory</strong></span> nomm&eacute; <span class="italic">AMQ_Send_ConnectionFactory</span> pour afficher sa vue <span class="bold"><strong>Basic settings</strong></span> dans l'onglet <span class="bold"><strong>Component</strong></span>.</p><div class="mediaobject"><img src="../images/use_case-cjms15.png"></div></li><li class="step" title="&Eacute;tape 2"><p>Dans la liste <span class="bold"><strong>MQ Server</strong></span>, s&eacute;lectionnez un
						serveur MQ. Dans ce sc&eacute;nario, s&eacute;lectionnez le serveur par d&eacute;faut, ActiveMQ
						afin de g&eacute;rer les messages. </p></li><li class="step" title="&Eacute;tape 3"><p>Dans le champ <span class="bold"><strong>Broker URI</strong></span>, saisissez l'URI
						du serveur par d&eacute;faut d'Active MQ&nbsp;: <span class="italic">"tcp://localhost:61616"</span>.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="16pt"><img alt="[Note]" src="../images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Lorsque vous utilisez ActiveMQ pour traiter les messages entre
							diff&eacute;rentes Routes, vous devez d&eacute;marrer le serveur ActiveMQ avant
							d'ex&eacute;cuter ces Routes. Pour plus d'informations sur l'installation et le
							d&eacute;marrage su serveur ActiveMQ, consultez la section concernant
							l'installation d'Apache ActiveMQ dans le <span class="italic">Guide
								d'installation de Talend ESB</span>. </p></td></tr></table></div></li><li class="step" title="&Eacute;tape 4"><p>Double-cliquez sur le composant <span class="bold"><strong>cConfig</strong></span>,
						nomm&eacute; <span class="italic">DatasetConfig</span>, pour afficher sa vue
							<span class="bold"><strong>Basic settings</strong></span> dans l'onglet <span class="bold"><strong>Component</strong></span>. </p><p>
						</p><div class="mediaobject"><img src="../images/use_case-cjms16.png"></div><p>
					</p></li><li class="step" title="&Eacute;tape 5"><p>Dans le champ <span class="bold"><strong>Code</strong></span>, saisissez du code
						pour enregistrer l'instance du jeu de donn&eacute;es <span class="italic">hello</span> dans le Registry, comme ci-dessous. </p><pre class="programlisting">org.apache.camel.component.dataset.SimpleDataSet dataset = new 
org.apache.camel.component.dataset.SimpleDataSet(1);
dataset.setDefaultBody("Test Data: hello world!");
org.apache.camel.impl.SimpleRegistry registry = new  
org.apache.camel.impl.SimpleRegistry();
     registry.put("hello",dataset);
camelContext.setRegistry(registry); </pre></li><li class="step" title="&Eacute;tape 6"><p>Double-cliquez sur le composant <span class="bold"><strong>cMessagingEndpoint</strong></span>, nomm&eacute; <span class="italic">SimpleDatasetGen</span>, pour afficher sa vue <span class="bold"><strong>Basic settings</strong></span> dans l'onglet <span class="bold"><strong>Component</strong></span>. </p><p>
						</p><div class="mediaobject"><img src="../images/use_case-cjms17.png"></div><p>
					</p></li><li class="step" title="&Eacute;tape 7"><p>Dans le champ <span class="bold"><strong>URI</strong></span>, saisissez
							<span class="emphasis"><em>dataset:hello</em></span> entre les guillemets. </p></li><li class="step" title="&Eacute;tape 8"><p>Double-cliquez sur le composant <span class="bold"><strong>cJMS</strong></span>
						nomm&eacute; <span class="italic">AMQ_Send</span> pour afficher sa vue
							<span class="bold"><strong>Basic settings</strong></span>.</p><div class="mediaobject"><img src="../images/use_case-cjms17bis.png"></div></li><li class="step" title="&Eacute;tape 9"><p>Dans la liste <span class="bold"><strong>Type</strong></span>, s&eacute;lectionnez
							<span class="bold"><strong>queue</strong></span> pour envoyer le message dans une
						file JMS.</p><p>Dans le champ <span class="bold"><strong>Destination</strong></span>, saisissez le
						nom de la file JMS, <span class="italic">"queue.hello"</span> dans ce
						sc&eacute;nario.</p><p>Double-cliquez sur le bouton <span class="bold"><strong>[...]</strong></span> &agrave; c&ocirc;t&eacute; de <span class="bold"><strong>ConnectionFactory</strong></span>. S&eacute;lectionnez la
						ConnectionFactory JMS que vous venez de configurer puis cliquez sur
							<span class="bold"><strong>OK</strong></span>. Vous pouvez &eacute;galement saisir le nom
						du composant <span class="bold"><strong>cJMSConnectionFactory</strong></span>
						directement dans le champ.</p><div class="mediaobject"><img src="../images/use_case-cjms17ter.png"></div></li><li class="step" title="&Eacute;tape 10"><p>Double-cliquez sur le composant <span class="bold"><strong>cProcessor</strong></span> nomm&eacute;
							<span class="italic">PrintSendMsg</span> pour afficher sa vue
							<span class="bold"><strong>Basic settings</strong></span> dans l'onglet <span class="bold"><strong>Component</strong></span>, et personnalisez le code dans la zone
							<span class="bold"><strong>Code</strong></span> afin d'afficher le message envoy&eacute;
						qui sera intercept&eacute; dans la console.</p><pre class="programlisting">System.out.println("AMQ Send: "+
exchange.getIn().getBody(String.class));</pre></li></ol></div><div class="procedure" title="Proc&eacute;dure&nbsp;3.3.&nbsp;Ex&eacute;cuter la Route"><a name="d0e5657"></a><p class="title"><b>Proc&eacute;dure&nbsp;3.3.&nbsp;Ex&eacute;cuter la Route</b></p><ul class="procedure"><li class="step" title="&Eacute;tape 1"><p>Cliquez sur le bouton <span class="bold"><strong>Run</strong></span> de la vue <span class="bold"><strong>Run</strong></span> pour ex&eacute;cuter votre Route. Vous pouvez
						&eacute;galement appuyer sur <span class="bold"><strong>F6</strong></span> pour l'ex&eacute;cuter. </p><p>R&eacute;sultat&nbsp;: Un message <span class="italic">"hello world!"</span>
						est envoy&eacute; dans la file JMS, comme affich&eacute; dans la console de la vue
							<span class="bold"><strong>Run</strong></span>.</p><div class="mediaobject"><img src="../images/use_case-cjms18.png"></div></li></ul></div></div><div class="section" title="Tester le message re&ccedil;u"><div class="titlepage"><div><div><h4 class="title"><a name="d0e5683"></a>Tester le message re&ccedil;u</h4></div></div></div><div class="mediaobject"><img src="../images/use_case-cjms8.png"></div><div class="procedure" title="Proc&eacute;dure&nbsp;3.4.&nbsp;D&eacute;poser et relier les composants"><a name="d0e5689"></a><p class="title"><b>Proc&eacute;dure&nbsp;3.4.&nbsp;D&eacute;poser et relier les composants</b></p><ol class="procedure" type="1"><li class="step" title="&Eacute;tape 1"><p>Depuis la <span class="bold"><strong>Palette</strong></span>, d&eacute;posez les quatre
						composants suivants dans l'espace de mod&eacute;lisation graphique&nbsp;: un <span class="bold"><strong>cJMS</strong></span>, deux composants <span class="bold"><strong>cProcessor</strong></span> et un <span class="bold"><strong>cJMSConnectionFactory</strong></span>.</p></li><li class="step" title="&Eacute;tape 2"><p>Reliez le composant <span class="bold"><strong>cJMS</strong></span> au premier
							<span class="bold"><strong>cProcessor</strong></span> &agrave; l'aide d'un lien <span class="bold"><strong>Row</strong></span> &gt; <span class="bold"><strong>Route</strong></span>.</p></li><li class="step" title="&Eacute;tape 3"><p>Reliez le premier <span class="bold"><strong>cProcessor</strong></span> au second
							<span class="bold"><strong>cProcessor</strong></span> &agrave; l'aide d'un lien <span class="bold"><strong>Row</strong></span> &gt; <span class="bold"><strong>Route</strong></span>.</p></li></ol></div><div class="procedure" title="Proc&eacute;dure&nbsp;3.5.&nbsp;Configurer les composants"><a name="d0e5737"></a><p class="title"><b>Proc&eacute;dure&nbsp;3.5.&nbsp;Configurer les composants</b></p><ol class="procedure" type="1"><li class="step" title="&Eacute;tape 1"><p>Double-cliquez sur le composant <span class="bold"><strong>cJMSConnectionFactory</strong></span> nomm&eacute; <span class="italic">AMQ_Rev_ConnectionFactory</span> pour afficher sa vue <span class="bold"><strong>Basic settings</strong></span> dans l'onglet <span class="bold"><strong>Component</strong></span>.</p><div class="mediaobject"><img src="../images/use_case-cjms11.png"></div></li><li class="step" title="&Eacute;tape 2"><p>Dans la liste <span class="bold"><strong>MQ Server</strong></span>, s&eacute;lectionnez un
						serveur MQ. Dans ce sc&eacute;nario, s&eacute;lectionnez le serveur par d&eacute;faut, ActiveMQ
						afin de g&eacute;rer les messages. </p><p>Cochez la case <span class="bold"><strong>Use transaction</strong></span> check
						box.</p></li><li class="step" title="&Eacute;tape 3"><p>Dans le champ <span class="bold"><strong>Broker URI</strong></span>, saisissez l'URI
						du serveur par d&eacute;faut d'Active MQ&nbsp;: <span class="italic">"tcp://localhost:61616"</span>.</p></li><li class="step" title="&Eacute;tape 4"><p>Double-cliquez sur le composant <span class="bold"><strong>cJMS</strong></span>
						nomm&eacute; <span class="italic">AMQ_Rev</span> pour afficher sa vue
							<span class="bold"><strong>Basic settings</strong></span>.</p><div class="mediaobject"><img src="../images/use_case-cjms12.png"></div></li><li class="step" title="&Eacute;tape 5"><p>Dans la liste <span class="bold"><strong>Type</strong></span>, s&eacute;lectionnez
							<span class="bold"><strong>queue</strong></span> pour envoyer le message dans une
						file JMS.</p><p>Dans le champ <span class="bold"><strong>Destination</strong></span>, saisissez le
						nom de la file JMS, <span class="italic">"queue.hello"</span> dans ce
						sc&eacute;nario.</p><p>Double-cliquez sur le bouton <span class="bold"><strong>[...]</strong></span> &agrave; c&ocirc;t&eacute; de <span class="bold"><strong>ConnectionFactory</strong></span>. S&eacute;lectionnez la
						ConnectionFactory JMS que vous venez de configurer puis cliquez sur
							<span class="bold"><strong>OK</strong></span>. Vous pouvez &eacute;galement saisir le nom
						du composant <span class="bold"><strong>cJMSConnectionFactory</strong></span>
						directement dans le champ.</p><div class="mediaobject"><img src="../images/use_case-cjms13.png"></div></li><li class="step" title="&Eacute;tape 6"><p>Double-cliquez sur le premier composant <span class="bold"><strong>cProcessor</strong></span> nomm&eacute;
							<span class="italic">PrintRevMsg</span> pour afficher sa vue
							<span class="bold"><strong>Basic settings</strong></span> dans l'onglet <span class="bold"><strong>Component</strong></span>, et personnalisez le code dans la zone
							<span class="bold"><strong>Code</strong></span> afin d'afficher le message re&ccedil;u
						qui sera intercept&eacute; dans la console.</p><pre class="programlisting">System.out.println("AMQ Receive: "+
exchange.getIn().getBody(String.class));</pre></li><li class="step" title="&Eacute;tape 7"><p>Double-cliquez sur le second composant <span class="bold"><strong>cProcessor</strong></span> nomm&eacute; <span class="italic">ThrowEx</span>
						pour afficher sa vue <span class="bold"><strong>Basic settings</strong></span> dans
						l'onglet <span class="bold"><strong>Component</strong></span>, et personnalisez le
						code dans la zone <span class="bold"><strong>Code</strong></span> afin de g&eacute;n&eacute;rer
						l'exception <span class="italic">Force fail</span> chaque fois qu'un
						&eacute;change est trait&eacute; par cette Route.</p><pre class="programlisting">throw new Exception("Force fail")</pre></li></ol></div><div class="procedure" title="Proc&eacute;dure&nbsp;3.6.&nbsp;Ex&eacute;cuter la Route"><a name="d0e5870"></a><p class="title"><b>Proc&eacute;dure&nbsp;3.6.&nbsp;Ex&eacute;cuter la Route</b></p><ul class="procedure"><li class="step" title="&Eacute;tape 1"><p>Cliquez sur le bouton <span class="bold"><strong>Run</strong></span> de la vue
							<span class="bold"><strong>Run</strong></span> pour ex&eacute;cuter votre Route. Vous
						pouvez &eacute;galement appuyer sur <span class="bold"><strong>F6</strong></span> pour
						l'ex&eacute;cuter. </p><p>R&eacute;sultat&nbsp;: Le message <span class="italic">"hello world!"</span>
						est test&eacute; et une transaction de rollback (retour &agrave; l'&eacute;tat ant&eacute;rieur) est
						effectu&eacute;e. Lorsque six tentatives de renvoi du message sont atteintes, le
						message en attente est envoy&eacute; dans la file JMS <span class="italic">Dead
							Letter</span>.</p></li></ul></div><div class="section" title="Consommer le message situ&eacute; dans la file JMS Dead Letter"><div class="titlepage"><div><div><h5 class="title"><a name="d0e5893"></a>Consommer le message situ&eacute; dans la file JMS <span class="italic">Dead
						Letter</span>
				</h5></div></div></div><div class="mediaobject"><img src="../images/use_case-cjms10.png"></div><div class="procedure" title="Proc&eacute;dure&nbsp;3.7.&nbsp;D&eacute;poser et relier les composants"><a name="d0e5902"></a><p class="title"><b>Proc&eacute;dure&nbsp;3.7.&nbsp;D&eacute;poser et relier les composants</b></p><ol class="procedure" type="1"><li class="step" title="&Eacute;tape 1"><p>Depuis la <span class="bold"><strong>Palette</strong></span>, d&eacute;posez les trois
							composants suivants dans l'espace de mod&eacute;lisation graphique&nbsp;: un
								<span class="bold"><strong>cJMSConnectionFactory</strong></span>, un <span class="bold"><strong>cJMS</strong></span> et un composant <span class="bold"><strong>cProcessor</strong></span>.</p></li><li class="step" title="&Eacute;tape 2"><p>Reliez le composant <span class="bold"><strong>cJMS</strong></span> au <span class="bold"><strong>cProcessor</strong></span> &agrave; l'aide d'un lien <span class="bold"><strong>Row</strong></span> &gt; <span class="bold"><strong>Route</strong></span>.</p></li></ol></div><div class="procedure" title="Proc&eacute;dure&nbsp;3.8.&nbsp;Configurer les composants"><a name="d0e5935"></a><p class="title"><b>Proc&eacute;dure&nbsp;3.8.&nbsp;Configurer les composants</b></p><ol class="procedure" type="1"><li class="step" title="&Eacute;tape 1"><p>Double-cliquez sur le composant <span class="bold"><strong>cJMSConnectionFactory</strong></span> pour afficher sa vue <span class="bold"><strong>Basic settings</strong></span> dans l'onglet <span class="bold"><strong>Component</strong></span>.</p><div class="mediaobject"><img src="../images/use_case-cjms19.png"></div></li><li class="step" title="&Eacute;tape 2"><p>Dans la liste <span class="bold"><strong>MQ Server</strong></span>, s&eacute;lectionnez
							un serveur MQ. Dans ce sc&eacute;nario, s&eacute;lectionnez le serveur par d&eacute;faut,
							ActiveMQ afin de g&eacute;rer les messages. </p></li><li class="step" title="&Eacute;tape 3"><p>Dans le champ <span class="bold"><strong>Broker URI</strong></span>, saisissez
							l'URI du serveur par d&eacute;faut d'Active MQ&nbsp;: <span class="italic">"tcp://localhost:61616"</span>.</p></li><li class="step" title="&Eacute;tape 4"><p>Double-cliquez sur le composant <span class="bold"><strong>cJMS</strong></span>
							nomm&eacute; <span class="italic">DeadLetterQueueJMS</span> pour
							afficher sa vue <span class="bold"><strong>Basic settings</strong></span>.</p><div class="mediaobject"><img src="../images/use_case-cjms20.png"></div></li><li class="step" title="&Eacute;tape 5"><p>Dans la liste <span class="bold"><strong>Type</strong></span>, s&eacute;lectionnez
								<span class="bold"><strong>queue</strong></span> pour envoyer le message dans
							une file JMS.</p><p>Dans le champ <span class="bold"><strong>Destination</strong></span>, saisissez
							le nom de la file JMS, <span class="italic">"ActiveMQ.DLQ"</span>
							dans ce sc&eacute;nario (la file d'attente <span class="italic">Dead
								Letter</span> par d&eacute;faut dans ActiveMQ).</p><p>Double-cliquez sur le bouton <span class="bold"><strong>[...]</strong></span> &agrave;
							c&ocirc;t&eacute; de <span class="bold"><strong>ConnectionFactory</strong></span>. S&eacute;lectionnez
							la ConnectionFactory JMS que vous venez de configurer puis cliquez sur
								<span class="bold"><strong>OK</strong></span>. Vous pouvez &eacute;galement saisir le
							nom du composant <span class="bold"><strong>cJMSConnectionFactory</strong></span>
							directement dans le champ.</p><div class="mediaobject"><img src="../images/use_case-cjms21.png"></div></li><li class="step" title="&Eacute;tape 6"><p>Double-cliquez sur le composant <span class="bold"><strong>cProcessor</strong></span> nomm&eacute; <span class="italic">PrintMsg</span> pour afficher sa vue <span class="bold"><strong>Basic settings</strong></span> dans l'onglet <span class="bold"><strong>Component</strong></span>, et personnalisez le code dans la zone
								<span class="bold"><strong>Code</strong></span> afin d'afficher le message
							re&ccedil;u qui sera intercept&eacute; dans la console.</p><pre class="programlisting">System.out.println("AMQ Receive: "+ 
exchange.getIn().getBody(String.class));</pre></li></ol></div><div class="procedure" title="Proc&eacute;dure&nbsp;3.9.&nbsp;Ex&eacute;cuter la Route"><a name="d0e6040"></a><p class="title"><b>Proc&eacute;dure&nbsp;3.9.&nbsp;Ex&eacute;cuter la Route</b></p><ul class="procedure"><li class="step" title="&Eacute;tape 1"><p>Cliquez sur le bouton <span class="bold"><strong>Run</strong></span> de la vue
								<span class="bold"><strong>Run</strong></span> pour ex&eacute;cuter votre Route. Vous
							pouvez &eacute;galement appuyer sur <span class="bold"><strong>F6</strong></span> pour
							l'ex&eacute;cuter. </p><p>R&eacute;sultat&nbsp;: Le message <span class="italic">"hello
								world!"</span> qui &eacute;tait dans la file <span class="italic">Dead Letter</span> est consomm&eacute;, comme affich&eacute; dans la console
								<span class="bold"><strong>Run</strong></span>.</p><div class="mediaobject"><img src="../images/use_case-cjms22.png"></div></li></ul></div></div></div></div></div></body></html>