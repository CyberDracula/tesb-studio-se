<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>cMessageFilter</title><meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"><link rel="home" href="index.html" title="Talend Open Studio"><link rel="up" href="ch06.html" title="Chapter&nbsp;6.&nbsp;Routing components"><link rel="prev" href="cLoadBalancer.html" title="cLoadBalancer"><link rel="next" href="cMessageRouter.html" title="cMessageRouter"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div lang="EN" class="section" title="cMessageFilter"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cMessageFilter"></a>cMessageFilter</h2></div></div></div><div class="mediaobject"><img src="../images/cMessageFilter_icon32_white.png"></div><div class="section" title="cMessageFilter properties"><div class="titlepage"><div><div><h3 class="title"><a name="d0e12676"></a>cMessageFilter properties</h3></div></div></div><div class="informaltable"><table border="1"><colgroup><col class="c1"><col class="c2"><col class="c3"></colgroup><tbody><tr><td valign="top"><p><span class="bold"><strong>Component
								Family</strong></span></p>
						</td><td colspan="2" valign="top"><p>Routing</p>
						</td></tr><tr><td valign="top"><p><span class="bold"><strong>Function</strong></span></p>
						</td><td colspan="2" valign="top"><p><span class="bold"><strong>cMessageFilter</strong></span> filters the content of messages according to
								the specified criterion and routes the filtered messages to the
								specified output channel. All messages that do not match the
								criteria will be dropped.</p><p> For more information on the
								Camel Message Filter EIP: <a class="link" href="http://camel.apache.org/message-filter.html" target="_top">http://camel.apache.org/message-filter.html</a>.</p>
						</td></tr><tr><td valign="top"><p><span class="bold"><strong>Purpose</strong></span></p>
						</td><td colspan="2" valign="top"><p>Use <span class="bold"><strong>cMessageFilter</strong></span> to eliminate unwanted messages from a
								channel according to the defined criterion.</p>
						</td></tr><tr><td valign="top"><p><span class="bold"><strong>Basic
								settings</strong></span></p>
						</td><td valign="top"><p><span class="emphasis"><em>Language</em></span></p>
						</td><td valign="top"><p>Select the language of the expression you use to
								filter your messages from <span class="bold"><strong>Constant</strong></span>,
									<span class="bold"><strong>EL</strong></span>, <span class="bold"><strong>Groovy</strong></span>, <span class="bold"><strong>Header</strong></span>,
									<span class="bold"><strong>JavaScript</strong></span>, <span class="bold"><strong>JoSQL</strong></span>, <span class="bold"><strong>JXPath</strong></span>, <span class="bold"><strong>MVEL</strong></span>,
									<span class="bold"><strong>None</strong></span>, <span class="bold"><strong>OGNL</strong></span>, <span class="bold"><strong>PHP</strong></span>,
									<span class="bold"><strong>Property</strong></span>, <span class="bold"><strong>Python</strong></span>, <span class="bold"><strong>Ruby</strong></span>,
									<span class="bold"><strong>Simple</strong></span>, <span class="bold"><strong>SpEL</strong></span>, <span class="bold"><strong>SQL</strong></span>,
									<span class="bold"><strong>XPath</strong></span>, and <span class="bold"><strong>XQuery</strong></span>.</p>
						</td></tr><tr><td><p>&nbsp;</p>
						</td><td valign="top"><p><span class="emphasis"><em>Expression</em></span></p>
						</td><td valign="top"><p>Type in the expression to use to filter the
								messages.</p>
						</td></tr><tr><td valign="top"><p><span class="bold"><strong>Usage</strong></span></p>
						</td><td colspan="2" valign="top"><p><span class="bold"><strong>cMessageFilter</strong></span> is used as a middle component in a
								Route.</p>
						</td></tr><tr><td valign="top"><span class="bold"><strong>Connections</strong></span></td><td valign="top"><span class="italic">Filter</span></td><td valign="top">Select this link to route the filtered messages to the
							next endpoint.</td></tr><tr><td valign="top">&nbsp;</td><td valign="top"><span class="italic">Route</span></td><td valign="top">Select this link to route all the messages from the
							sender to the next endpoint.</td></tr><tr><td valign="top"><p><span class="bold"><strong>Limitation</strong></span></p>
						</td><td colspan="2"><p>&nbsp;n/a</p>
						</td></tr></tbody></table></div></div><div class="section" title="Scenario: Filtering messages according to a criterion"><div class="titlepage"><div><div><h3 class="title"><a name="d0e12849"></a>Scenario: Filtering messages according to a criterion</h3></div></div></div><p>In this use case, we filter XML messages that are sent from the sending endpoint according
			to a defined criterion: only the XML files in which the value of the
				<span class="emphasis"><em>city</em></span> node is <span class="emphasis"><em>Paris</em></span> are sent to a folder
			named <span class="emphasis"><em>Paris_only</em></span>.</p><p>Of the four XML files used in this scenario, <span class="italic">Message_1.xml</span> and <span class="italic">Message_4.xml</span>
			contain the city name of <span class="italic">Paris</span>. The following is an
			example:</p><pre class="programlisting">&lt;person&gt;
  &lt;firstName&gt;Pierre&lt;/firstName&gt;
  &lt;lastName&gt;Dupont&lt;/lastName&gt;
  &lt;city&gt;Paris&lt;/city&gt;
&lt;/person&gt;</pre><div class="section" title="Dropping and linking the components"><div class="titlepage"><div><div><h4 class="title"><a name="d0e12876"></a>Dropping and linking the components</h4></div></div></div><p>This scenario requires one <span class="bold"><strong>cMessageFilter</strong></span>
				component to filter the messages from the sender, one <span class="bold"><strong>cFile</strong></span> component as the message sender, one <span class="bold"><strong>cFile</strong></span> component to receiver the messages containing <span class="italic">Paris</span>, one <span class="bold"><strong>cFile</strong></span>
				component to receiver all the messages from the sender, and two <span class="bold"><strong>cProcessor</strong></span> components to monitor the messages routed to
				the two receivers.</p><div class="mediaobject"><img src="../images/cmessagefilter_scenario1.png"></div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p>From the <span class="bold"><strong>Messaging</strong></span> folder of the
							<span class="bold"><strong>Palette</strong></span>, drop three <span class="bold"><strong>cFile</strong></span> components onto the design workspace, and
						label them <span class="italic">Sender</span>, <span class="italic">Paris_only</span>, and <span class="italic">Unfiltered</span> respectively to better identify their
						roles.</p></li><li class="step" title="Step 2"><p>From the <span class="bold"><strong>Routing</strong></span> folder, drop a <span class="bold"><strong>cMessageFilter</strong></span> component onto the design workspace, and
						label it <span class="italic">Filter</span>.</p></li><li class="step" title="Step 3"><p>From the <span class="bold"><strong>Processor</strong></span> folder, drop two
							<span class="bold"><strong>cProcessor</strong></span> components onto the design
						workspace, and label them <span class="italic">Monitor_Paris</span>
						and <span class="italic">Monitor_Unfiltered</span>
						respectively.</p></li><li class="step" title="Step 4"><p>Right-click the <span class="bold"><strong>cFile</strong></span> component labeled
							<span class="italic">Sender</span>, select <span class="bold"><strong>Row</strong></span> &gt; <span class="bold"><strong>Route</strong></span> from the
						contextual menu and click the <span class="bold"><strong>cMessageFilter</strong></span> component. </p></li><li class="step" title="Step 5"><p>Right-click the <span class="bold"><strong>cMessageFilter</strong></span> component,
						select <span class="bold"><strong>Row</strong></span> &gt; <span class="bold"><strong>Filter</strong></span> from the contextual menu and click the <span class="bold"><strong>cFile</strong></span> component labeled <span class="italic">Paris_only</span>. This endpoint will retrieve the messages that
						meet the defined criterion.</p></li><li class="step" title="Step 6"><p>Right-click the <span class="bold"><strong>cMessageFilter</strong></span> component,
						select <span class="bold"><strong>Row</strong></span> &gt; <span class="bold"><strong>Route</strong></span> from the contextual menu and click the <span class="bold"><strong>cFile</strong></span> component labeled <span class="italic">Unfiltered</span>. This endpoint will collect all the messages,
						including those meeting the filter criterion. This connection is
						optional.</p></li><li class="step" title="Step 7"><p>Right-click the <span class="bold"><strong>cFile</strong></span> component labeled
							<span class="italic">Paris_only</span>, select <span class="bold"><strong>Row</strong></span> &gt; <span class="bold"><strong>Route</strong></span> from
						the contextual menu and click the <span class="bold"><strong>cProcessor</strong></span> component labeled <span class="italic">Monitor_Paris</span>. Repeat this step to connect the <span class="bold"><strong>cFile</strong></span> component labeled <span class="italic">Unfiltered</span> to the <span class="bold"><strong>cProcessor</strong></span> component labeled <span class="italic">Monitor_Unfiltered</span>.</p></li></ol></div></div><div class="section" title="Configuring the components and connections"><div class="titlepage"><div><div><h4 class="title"><a name="d0e13038"></a>Configuring the components and connections</h4></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Double-click the <span class="bold"><strong>cFile</strong></span> component labeled
							<span class="italic">Sender</span> to open its <span class="bold"><strong>Basic settings</strong></span> view in the <span class="bold"><strong>Component</strong></span> tab.</p><div class="mediaobject" align="center"><img src="../images/cmessagefilter_scenario1_bis.png" align="middle"></div></li><li class="step" title="Step 2"><p>In the <span class="bold"><strong>Path</strong></span> field, specify the file path
						to message source.</p></li><li class="step" title="Step 3"><p>From the <span class="bold"><strong>Encoding</strong></span> list, select the
						encoding type of your message files. Leave the other parameters as they
						are.</p></li><li class="step" title="Step 4"><p>Double-click the <span class="bold"><strong>cMessageFilter</strong></span> component
						to open its <span class="bold"><strong>Basic settings</strong></span> view in the
							<span class="bold"><strong>Component</strong></span> tab.</p><div class="mediaobject"><img src="../images/cmessagefilter_scenario2.png"></div></li><li class="step" title="Step 5"><p>Select the language of the expression you want to use to filter your
						messages, and enter an expression to define a criterion according to which
						you want to filter your messages. </p><p>In this scenario, we want to sort out the XML files containing a city node
						with the value of Paris, so we select <span class="bold"><strong>XPath</strong></span>
						from the <span class="bold"><strong>Language</strong></span> list, and fill the in the
							<span class="bold"><strong>Expression</strong></span> field with this expression:
							<code class="code">"/person[city='Paris']"</code>.</p></li><li class="step" title="Step 6"><p>Double-click the <span class="bold"><strong>cFile</strong></span> component labeled
							<span class="italic">Paris_only</span> to open its <span class="bold"><strong>Basic settings</strong></span> view in the <span class="bold"><strong>Component</strong></span> view, and specify the path for the messages
						meeting the filter criterion in the <span class="bold"><strong>Path</strong></span>
						field. </p><div class="mediaobject"><img src="../images/cmessagefilter_scenario3.png"></div><p>Repeat this step to define the path for all the messages from the sender
						in the <span class="bold"><strong>cFile</strong></span> component labeled <span class="italic">Unfiltered</span>.</p></li><li class="step" title="Step 7"><p>Double-click the <span class="bold"><strong>cProcessor</strong></span> component labeled <span class="italic">Monitor_Paris</span> to open its <span class="bold"><strong>Basic settings</strong></span> view in the <span class="bold"><strong>Component</strong></span> view, and customize the code in the <span class="bold"><strong>Code</strong></span> area to display the file names of the
						messages that meet the filter criterion on the console:</p><pre class="programlisting">System.out.println("Message sent to folder Paris_only: "+
exchange.getIn().getHeader("CamelFileName"));</pre><p>Repeat this step to customize the code in the <span class="bold"><strong>cProcessor</strong></span>
						component labeled <span class="italic">Monitor_Unfiltered</span> to
						display the file names of all the messages from the sender.</p></li><li class="step" title="Step 8"><p>Press <span class="bold"><strong>Ctrl+S</strong></span> to save your Route.</p></li></ol></div></div><div class="section" title="Viewing the code and executing the Route"><div class="titlepage"><div><div><h4 class="title"><a name="d0e13167"></a>Viewing the code and executing the Route</h4></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p>To have a look at the generated code, click the <span class="bold"><strong>Code</strong></span> tab at the bottom of the design workspace.</p><div class="mediaobject"><img src="../images/cmessagefilter_scenario4.png"></div><p>As shown in this piece of code, messages <code class="code">from</code> the sender are filtered by
							<code class="code">cMessageFilter_1</code> according to
							<code class="code">.xpath("/person[city='Paris']")</code> and the messages matching
						the filter are send <code class="code">.to</code> the endpoint <code class="code">Paris_only</code>,
						while all messages are sent <code class="code">.to</code> the endpoint
							<code class="code">Unfiltered</code>.</p></li><li class="step" title="Step 2"><p>Click the <span class="bold"><strong>Run</strong></span> view to display it and
						click the <span class="bold"><strong>Run</strong></span> button to launch the
						execution of your Route. </p><p>You can also press <span class="bold"><strong>F6</strong></span> to execute it. </p><p>RESULT: The messages are filtered according to the defined criterion and the messages
						containing "<span class="emphasis"><em>Paris</em></span>" are redirected to the <span class="italic">Paris_only</span> folder, all the messages, including
						those containing "<span class="emphasis"><em>Paris</em></span>", are sent to the <span class="italic">Unfiltered</span> folder.</p><div class="mediaobject"><img src="../images/cmessagefilter_scenario5.png"></div></li></ol></div></div></div></div></body></html>